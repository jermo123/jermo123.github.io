<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Meta Tags and Title -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CVDQ Manager - Meeting Topics</title>
    
    <!-- Fonts and Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Custom Styles -->
    <style>
        body {
            font-family: 'Nunito', sans-serif;
            background-color: #f8f9fc;
        }
        #wrapper {
            display: flex;
            height: 100vh;
        }
        /* Sidebar Styles */
        .sidebar {
            width: 250px;
            background-color: #4e73df;
            color: #fff;
            flex-shrink: 0;
            transition: all 0.3s;
            overflow-y: auto;
        }
        .sidebar .sidebar-brand {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            background-color: #2e59d9;
        }
        .sidebar .nav-link {
            color: #fff;
            padding: 0.75rem 1.25rem;
            display: flex;
            align-items: center;
            transition: background 0.3s;
        }
        .sidebar .nav-link:hover {
            background-color: #1d2c8a;
            text-decoration: none;
        }
        .sidebar .nav-link i {
            margin-right: 0.75rem;
        }
        .sidebar .collapse .nav-link {
            padding-left: 2.5rem;
        }
        /* Content Styles */
        #content-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        /* Topbar Styles */
        .topbar {
            background-color: #fff;
            padding: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        /* Main Content */
        .container-fluid {
            padding: 2rem;
            flex: 1;
            overflow-y: auto;
        }
        /* Card Styles */
        .card {
            border: none;
            border-radius: 0.5rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .card-header {
            background-color: #4e73df;
            color: #fff;
            border-top-left-radius: 0.5rem;
            border-top-right-radius: 0.5rem;
        }
        /* Footer Styles */
        .footer {
            background-color: #f1f1f1;
            text-align: center;
            padding: 1rem;
            font-size: 0.9rem;
            color: #6c757d;
        }
        /* Meeting Topics Styles */
        .topic-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #e3e6f0;
            cursor: grab;
        }
        .topic-item:last-child {
            border-bottom: none;
        }
        .topic-item.dragging {
            opacity: 0.5;
        }
        .topic-text {
            flex: 1;
            margin: 0 1rem;
        }
        .topic-text.important {
            font-weight: bold;
            color: #e74a3b;
        }
        .topic-actions i {
            margin-right: 0.5rem;
            cursor: pointer;
        }
        .topic-actions i:hover {
            color: #1d2c8a;
        }
    </style>
    
    <!-- Bootstrap 5 JS and Dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom Scripts -->
    <script>
        // Open Folder Function (Requires Backend Support)
        function openFolder(path) {
            if (window.pywebview && window.pywebview.api) {
                window.pywebview.api.open_folder(path);
            } else {
                alert('Folder access is not supported in this environment.');
            }
        }

        // Open Window Function
        function openWindow(url) {
            const width = 1100;
            const height = 800;
            const left = (screen.width - width) / 2;
            const top = (screen.height - height) / 2;
            
            window.open(url, 'popupWindow', `width=${width},height=${height},scrollbars=yes,menubar=no,toolbar=no,location=no,status=no,left=${left},top=${top}`);
        }

        // Update Date and Time
        function updateDateTime() {
            const now = new Date();
            const options = {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            };
            const formattedDateTime = now.toLocaleString('en-US', options);
            document.getElementById('datetime').innerText = formattedDateTime;
        }
        setInterval(updateDateTime, 1000);
        document.addEventListener('DOMContentLoaded', updateDateTime);
    </script>
</head>

<body id="page-top">
    <!-- Page Wrapper -->
    <div id="wrapper">
        <!-- Sidebar -->
        <nav class="sidebar d-flex flex-column">
            <ul class="nav flex-column mt-4">
                <!-- Same Sidebar Content as Provided -->
                <!-- Add your sidebar items here, or copy from your existing page -->
                <!-- ... (copy the sidebar content from your existing page) ... -->
                <!-- For brevity, not including the full sidebar here -->
            </ul>
        </nav>
        <!-- End of Sidebar -->

        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">
            <!-- Main Content -->
            <div id="content">
                <!-- Topbar -->
                <nav class="topbar">
                    <div id="datetime" class="fw-bold"></div>
                    <button class="btn btn-primary d-md-none" id="sidebarToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                </nav>
                <!-- End of Topbar -->

                <!-- Begin Page Content -->
                <div class="container-fluid">
                    <h1 class="h3 mb-1 text-gray-800">Meeting Topics</h1>
                    
                    <!-- Meeting Topics Card -->
                    <div class="card shadow mb-4">
                        <div class="card-header py-3 d-flex justify-content-between align-items-center">
                            <h6 class="m-0 font-weight-bold text-white">Topics to Discuss</h6>
                            <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addTopicModal">
                                <i class="fas fa-plus"></i> Add Topic
                            </button>
                        </div>
                        <div class="card-body">
                            <div id="topicList" class="list-group">
                                <!-- Topics will be dynamically added here -->
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /.container-fluid -->

                <!-- Add Topic Modal -->
                <div class="modal fade" id="addTopicModal" tabindex="-1" aria-labelledby="addTopicModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <form id="addTopicForm">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="addTopicModalLabel">Add New Topic</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <div class="mb-3">
                                        <label for="topicTitle" class="form-label">Topic Title</label>
                                        <input type="text" class="form-control" id="topicTitle" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="topicDescription" class="form-label">Description</label>
                                        <textarea class="form-control" id="topicDescription" rows="3"></textarea>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="topicImportant">
                                        <label class="form-check-label" for="topicImportant">
                                            Mark as Important
                                        </label>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="submit" class="btn btn-primary">Add Topic</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Edit Topic Modal -->
                <div class="modal fade" id="editTopicModal" tabindex="-1" aria-labelledby="editTopicModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <form id="editTopicForm">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="editTopicModalLabel">Edit Topic</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <input type="hidden" id="editTopicId">
                                    <div class="mb-3">
                                        <label for="editTopicTitle" class="form-label">Topic Title</label>
                                        <input type="text" class="form-control" id="editTopicTitle" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="editTopicDescription" class="form-label">Description</label>
                                        <textarea class="form-control" id="editTopicDescription" rows="3"></textarea>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="editTopicImportant">
                                        <label class="form-check-label" for="editTopicImportant">
                                            Mark as Important
                                        </label>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="submit" class="btn btn-primary">Save Changes</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

            </div>
            <!-- End of Main Content -->

            <!-- Footer -->
            <footer class="footer">
                &copy; 2024 Dairy Queen Courtenay Manager's Dashboard. All rights reserved.
            </footer>
            <!-- End of Footer -->
        </div>
        <!-- End of Content Wrapper -->
    </div>
    <!-- End of Page Wrapper -->

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
    </a>

    <!-- Custom Scripts -->
    <script>
        // Sidebar Toggle for Mobile
        document.getElementById('sidebarToggle').addEventListener('click', function () {
            document.querySelector('.sidebar').classList.toggle('active');
        });

        // Meeting Topics Logic
        let topics = [];

        // Load topics from LocalStorage
        function loadTopics() {
            const storedTopics = localStorage.getItem('meetingTopics');
            if (storedTopics) {
                topics = JSON.parse(storedTopics);
            } else {
                topics = [];
            }
            renderTopics();
        }

        // Save topics to LocalStorage
        function saveTopics() {
            localStorage.setItem('meetingTopics', JSON.stringify(topics));
        }

        // Render topics to the page
        function renderTopics() {
            const topicList = document.getElementById('topicList');
            topicList.innerHTML = '';
            topics.forEach((topic, index) => {
                const topicItem = document.createElement('div');
                topicItem.classList.add('topic-item', 'list-group-item');
                topicItem.setAttribute('draggable', 'true');
                topicItem.dataset.index = index;

                // Drag and Drop Events
                topicItem.addEventListener('dragstart', handleDragStart);
                topicItem.addEventListener('dragover', handleDragOver);
                topicItem.addEventListener('drop', handleDrop);
                topicItem.addEventListener('dragend', handleDragEnd);

                const topicContent = document.createElement('div');
                topicContent.classList.add('topic-text');
                if (topic.important) {
                    topicContent.classList.add('important');
                }
                topicContent.innerHTML = `<strong>${topic.title}</strong><br>${topic.description}`;

                const topicActions = document.createElement('div');
                topicActions.classList.add('topic-actions');
                topicActions.innerHTML = `
                    <i class="fas fa-edit" title="Edit" onclick="editTopic(${index})"></i>
                    <i class="fas fa-trash-alt" title="Delete" onclick="deleteTopic(${index})"></i>
                `;

                topicItem.appendChild(topicContent);
                topicItem.appendChild(topicActions);
                topicList.appendChild(topicItem);
            });
        }

        // Add Topic
        document.getElementById('addTopicForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const title = document.getElementById('topicTitle').value.trim();
            const description = document.getElementById('topicDescription').value.trim();
            const important = document.getElementById('topicImportant').checked;

            topics.push({ title, description, important });
            saveTopics();
            renderTopics();

            // Reset form and close modal
            this.reset();
            const addModal = bootstrap.Modal.getInstance(document.getElementById('addTopicModal'));
            addModal.hide();
        });

        // Edit Topic
        function editTopic(index) {
            const topic = topics[index];
            document.getElementById('editTopicId').value = index;
            document.getElementById('editTopicTitle').value = topic.title;
            document.getElementById('editTopicDescription').value = topic.description;
            document.getElementById('editTopicImportant').checked = topic.important;

            const editModal = new bootstrap.Modal(document.getElementById('editTopicModal'));
            editModal.show();
        }

        // Save Edited Topic
        document.getElementById('editTopicForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const index = document.getElementById('editTopicId').value;
            const title = document.getElementById('editTopicTitle').value.trim();
            const description = document.getElementById('editTopicDescription').value.trim();
            const important = document.getElementById('editTopicImportant').checked;

            topics[index] = { title, description, important };
            saveTopics();
            renderTopics();

            // Reset form and close modal
            this.reset();
            const editModal = bootstrap.Modal.getInstance(document.getElementById('editTopicModal'));
            editModal.hide();
        });

        // Delete Topic
        function deleteTopic(index) {
            if (confirm('Are you sure you want to delete this topic?')) {
                topics.splice(index, 1);
                saveTopics();
                renderTopics();
            }
        }

        // Drag and Drop Functions
        let dragSrcEl = null;

        function handleDragStart(e) {
            this.classList.add('dragging');
            dragSrcEl = this;
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.innerHTML);
        }

        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault(); // Necessary. Allows us to drop.
            }
            e.dataTransfer.dropEffect = 'move';
            return false;
        }

        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation(); // Stops some browsers from redirecting.
            }

            if (dragSrcEl !== this) {
                const fromIndex = dragSrcEl.dataset.index;
                const toIndex = this.dataset.index;

                // Swap topics
                const temp = topics[fromIndex];
                topics[fromIndex] = topics[toIndex];
                topics[toIndex] = temp;

                saveTopics();
                renderTopics();
            }
            return false;
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function () {
            loadTopics();
        });
    </script>
</body>

</html>
